{%- liquid
  assign title = 'customer.addresses.title' | t
  assign add_new_title = 'customer.addresses.add_new' | t
  assign edit_address = 'customer.addresses.edit_address' | t
-%}

<account-addresses>
  <div class="md:grid md:grid-cols-3 auto-rows-fr border-t border-grey-600 xl:mx-20 md:mb-20 mb-8">
    {%- assign address_index = 1 -%}
    {%- for address in customer.addresses -%}
      {%- assign is_default_address = false -%}
      {%- if address.id == customer.default_address.id -%}
        {%- assign is_default_address = true -%}
      {%- endif -%}
      {%- if is_default_address -%}
        {%- assign address_title = 'customer.addresses.default' | t -%}
      {%- else -%}
        {%- assign address_title = 'Address ' | append: address_index -%}
        {%- assign address_index = address_index | plus: 1 -%}
      {%- endif -%}
      {%- render 'account-address-summary', address: address, title: address_title, default_address: is_default_address -%}
    {%- endfor -%}
    {%- render 'account-address-summary', type: 'new_address' -%}
  </div>

  {%- capture modal_content -%}
    {%- render 'account-address-form',
      address: customer.new_address,
      class: 'hidden',
      heading: add_new_title,
      ignore_script: true
    -%}
    {%- for address in customer.addresses -%}
      {%- assign is_default_address = false -%}
      {%- if address.id == customer.default_address.id -%}
        {%- assign is_default_address = true -%}
      {%- endif -%}

      {%- render 'account-address-form',
        address: address,
        class: 'hidden',
        heading: edit_address,
        default_address: is_default_address
      -%}
    {%- endfor -%}
  {%- endcapture -%}
  {%- render 'modal-dialog',
    content: modal_content,
    content_class: 'max-w-[480px] rounded mx-4 lg:mx-0 bg-white shadow-shadowPopup',
    class: 'p-0 bg-transparent rounded',
    close_button_class: 'close-popup text-grey-900 absolute md:top-7 md:right-8 top-4 right-9',
    scroll_target: '.js-address-form-content'
  -%}
</account-addresses>

{%- unless ignore_script == true -%}
  {%- capture src_url -%}
    {{- 'module-account-addresses.js' | asset_url -}}
  {%- endcapture -%}
  {%- render 'atom_script', src: src_url, priority: 'normal', type: 'defer' -%}
{%- endunless -%}
