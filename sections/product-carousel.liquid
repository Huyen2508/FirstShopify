{{- 'section-product-carousel.css' | asset_url | stylesheet_tag -}}

{% liquid
	assign blocks = section.blocks

  assign heading_class = " text-xl tracking-xsSpacing md:text-2xl md:tracking-mdSpacing "
  assign message_class = " text-base text-grey-900 tracking-xsSpacing mt-2 md:mt-3 "
  if section.settings.text_position == "2"
    assign heading_class = " text-2xl tracking-mdSpacing text-center md:text-3xl"
    assign message_class = message_class | append: ' text-center '
  endif

  assign active_title = true
  assign active_tab = true
%}

<div class="product-carousel-wrapper max-w-7xl mx-auto md:px-4 2xl:px-0">
  <div class="heading-message px-4 md:px-0">
    <p class="text-grey-900 font-bold {{ heading_class }}">{{ section.settings.heading }}</p>
    {%- if section.settings.message != '' -%}
      <div class="{{ message_class }}">{{ section.settings.message }}</div>
    {%- endif -%}
  </div>
  <div class="product-carousel-tabs">
    <ul class="tabs multi-titles">
      {%- capture list_title -%}
        {%- for block in blocks -%}
          {%- if block.settings.title != '' -%}
            <div
              class="tablink cursor-pointer mr-3 {% if active_title %} active {% endif %} text-center md:mx-3 item carousel-item snap-start shrink-0 title text-base tracking-xsSpacing font-bold px-4 py-2.5 border border-grey-3 rounded-100 whitespace-nowrap overflow-hidden text-ellipsis w-[calc(50%-6px)] md:text-lg md:py-3.5 md:px-6 md:text-clip	md:max-w-none md:w-auto"
              data-name="{{ block.settings.collection.handle }}"
              data-collection="{{ block.settings.collection.title }}-{{ block.settings.collection.id }}">{{ block.settings.title }}</div>
          {%- endif -%}

          {% liquid
            assign active_title = false
          %}
        {%- endfor -%}
      {%- endcapture -%}
      <div class="titles-desktop hidden md:flex justify-center">
        {{ list_title }}
      </div>

      {% liquid
        assign class_buttons_title =''

        if section.blocks.size < 3
          assign class_buttons_title = class_buttons_title | append: ' hidden '
        endif
      %}

      <div class="titles-mobile md:hidden max-w-sm mx-4">
        <div class="title-carousel">
          {%- render 'carousel', class_track: '', circle_button: true, class_buttons: class_buttons_title, class_wrap: '', class_main: 'flex', class_inner: '', class: 'carousel-enable', class_dots: '', content: list_title -%}
        </div>
      </div>
    </ul>
    <div class="multi-carousels mt-5 md:mt-8">
      {%- for block in blocks -%}
        {%- capture list_products -%}
          {%- for product in block.settings.collection.products limit: 16 -%}
            <div class="item carousel-item snap-start shrink-0 w-1/2 md:w-1/4 px-0.5 lg:px-2">
              {% render 'card-product' 
               , card_product: product,
               media_aspect_ratio: block.settings.image_ratio,
               show_secondary_image: block.settings.show_secondary_image,
               show_vendor: block.settings.show_vendor,
               show_rating: block.settings.show_rating,
               lazy_load: lazy_load %}
            </div>
          {%- endfor -%}
        {%- endcapture -%}

        {% liquid
          assign class_button_products =''

          if block.settings.collection.products.size < 3
            assign class_button_products = class_button_products | append: ' !hidden '
          else  
            assign class_button_products = class_button_products | append: ' !flex '
          endif

          if block.settings.collection.products.size < 5
            assign class_button_products = class_button_products | append: ' md:!hidden '
          else
            assign class_button_products = class_button_products | append: ' md:!flex '
          endif
        %}

        <div class="tabcontent overflow-x-hidden {% if active_tab %} active {% endif %} product-carousel" id="{{ block.settings.collection.title }}-{{ block.settings.collection.id }}">
          <div class="-mx-0.5 lg:-mx-2">
            {%- render 'carousel', class_track: '', class_button: '!flex', class_buttons: class_button_products, class_wrap: '', class_main: '', class_inner: '', class: 'carousel-enable', class_dots: '', content: list_products -%}

          </div>
        </div>
        {% liquid
          assign active_tab = false
        %}
      {%- endfor -%}
    </div>
  </div>
</div>

{%- capture src_url -%}
  {{- 'section-product-carousel.js' | asset_url -}}
{%- endcapture -%}
{%- render 'atom_script', src: src_url, priority: 'normal', type: 'defer' -%}

{% schema %}
  {
    "name": "Product Carousel",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      }, {
        "type": "richtext",
        "id": "message",
        "label": "Message"
      }, {
        "type": "select",
        "id": "text_position",
        "label": "Text's Position",
        "options": [
          {
            "value": "1",
            "label": "Left"
          }, {
            "value": "2",
            "label": "Center"
          }
        ],
        "default": "1"
      }
    ],
    "blocks": [
      {
        "type": "item",
        "name": "Item",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Title"
          }, {
            "type": "collection",
            "id": "collection",
            "label": "Collection"
          }
        ]
      }
    ],
    "max_blocks": 3,
    "presets": [
      {
        "name": "Product Carousel",
        "blocks": [
          {
            "type": "item"
          }, {
            "type": "item"
          }, {
            "type": "item"
          }

        ]
      }
    ]
  }
{% endschema %}